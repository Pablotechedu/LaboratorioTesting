# Demo 03 - Coverage Bajo (30%)
# Introducir el concepto de coverage con umbral BAJO

name: Demo 03 - Coverage 30%

on:
  push:
    branches: [ main, feature/* ]
  pull_request:
    branches: [ main ]

env:
  COVERAGE_THRESHOLD: 30

jobs:
  coverage-bajo:
    name: "Coverage Básico (30%)"
    runs-on: ubuntu-latest
    
    steps:
    # 1. Setup básico
    - name: Obtener código
      uses: actions/checkout@v4
    
    - name: Configurar Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        cache: 'npm'
    
    - name: Instalar dependencias
      run: npm ci
    
    # 2. Ejecutar tests con coverage
    - name: Ejecutar tests con coverage
      run: |
        echo "Generando reporte de coverage..."
        echo "Umbral configurado: ${{ env.COVERAGE_THRESHOLD }}%"
        npm run test:coverage
    
    # 3. Análisis del coverage (permisivo)
    - name: Verificar coverage (30% - Básico)
      run: |
        echo "Analizando coverage con umbral BAJO (30%)..."
        echo ""
        echo "¿Qué significa 30% de coverage?"
        echo "   Solo necesitas probar 3 de cada 10 líneas de código"
        echo "   Es muy fácil de alcanzar"
        echo "   Pero... ¿es suficiente para un proyecto serio?"
        echo ""
        echo "Con 30% de coverage:"
        echo "   Casi todos los proyectos pasan"
        echo "   Pero 70% del código NO está probado"
        echo "   ¿Qué pasa si ese 70% tiene bugs?"
        echo ""
        echo "Estado: Probablemente PASASTE"
        echo "Pero... ¿deberías sentirte seguro con solo 30%?"
    
    # 4. Demostración educativa
    - name: "Lección: Por qué importa el coverage"
      run: |
        echo "LECCIÓN IMPORTANTE:"
        echo ""
        echo "Coverage 30% significa:"
        echo "   De 100 líneas de código, solo 30 están probadas"
        echo "   70 líneas pueden tener bugs sin que lo sepas"
        echo "   ¿Te sentirías seguro desplegando así?"
        echo ""
        echo "Analogía:"
        echo "   Es como revisar solo 3 de 10 partes de tu carro"
        echo "   O probar solo 3 de 10 interruptores de tu casa"
        echo ""
        echo "Próximo paso: Subamos el umbral y veamos qué pasa..."
