# Demo 04 - Coverage Medio (60%)
# Aquí algunos proyectos empiezan a fallar

name: Demo 04 - Coverage 60%

on:
  push:
    branches: [ main, feature/* ]
  pull_request:
    branches: [ main ]

env:
  COVERAGE_THRESHOLD: 60

jobs:
  coverage-medio:
    name: "Coverage Moderado (60%)"
    runs-on: ubuntu-latest
    
    steps:
    # 1. Setup básico
    - name: Obtener código
      uses: actions/checkout@v4
    
    - name: Configurar Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        cache: 'npm'
    
    - name: Instalar dependencias
      run: npm ci
    
    # 2. Ejecutar tests con coverage
    - name: Ejecutar tests con coverage
      run: |
        echo "Generando reporte de coverage..."
        echo "Umbral configurado: ${{ env.COVERAGE_THRESHOLD }}%"
        npm run test:coverage
    
    # 3. Análisis del coverage (moderado)
    - name: Verificar coverage (60% - Moderado)
      run: |
        echo "Analizando coverage con umbral MODERADO (60%)..."
        echo ""
        echo "¿Qué significa 60% de coverage?"
        echo "   Necesitas probar 6 de cada 10 líneas de código"
        echo "   Ya no es tan fácil como 30%"
        echo "   40% del código sigue sin probar"
        echo ""
        echo "Con 60% de coverage:"
        echo "   Proyectos con buenos tests pasan"
        echo "   Proyectos con pocos tests empiezan a fallar"
        echo "   Es un punto de equilibrio razonable"
        echo ""
        echo "¿Tu proyecto pasa o falla?"
        echo "   Si pasa: Tienes bastantes tests"
        echo "   Si falla: Necesitas escribir más tests"
    
    # 4. Consejos prácticos
    - name: "Consejos para mejorar coverage"
      run: |
        echo "CONSEJOS PARA LLEGAR A 60%:"
        echo ""
        echo "Qué probar primero:"
        echo "   1. Funciones principales de tu app"
        echo "   2. Casos de uso más comunes"
        echo "   3. Funciones que manejan errores"
        echo ""
        echo "Tests fáciles de escribir:"
        echo "   Crear un recurso (POST)"
        echo "   Obtener recursos (GET)"
        echo "   Validaciones básicas"
        echo ""
        echo "Si tu proyecto falló aquí:"
        echo "   Escribe 2-3 tests más"
        echo "   Ejecuta npm run test:coverage localmente"
        echo "   Ve subir tu porcentaje"
