# Demo 02 - Tests Automáticos
# Ejecutar tests automáticamente en cada push

name: Demo 02 - Tests

on:
  push:
    branches: [ main, feature/* ]
  pull_request:
    branches: [ main ]

jobs:
  tests-automaticos:
    name: "Ejecutar Tests"
    runs-on: ubuntu-latest
    
    steps:
    # 1. Obtener código
    - name: Obtener código
      uses: actions/checkout@v4
    
    # 2. Configurar Node.js
    - name: Configurar Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        cache: 'npm'
    
    # 3. Instalar dependencias
    - name: Instalar dependencias
      run: |
        echo "Instalando dependencias para tests..."
        npm ci
        echo "Dependencias instaladas correctamente"
    
    # 4. Verificar que los scripts existen
    - name: Verificar scripts de NPM
      run: |
        echo "Scripts disponibles en package.json:"
        npm run
        echo ""
        echo "Verificando script 'test':"
        if npm run test --dry-run > /dev/null 2>&1; then
          echo "Script 'test' encontrado"
        else
          echo "Script 'test' no encontrado"
          echo "Tip: Agrega 'test': 'jest' en package.json"
        fi
    
    # 5. Ejecutar tests
    - name: Ejecutar tests
      run: |
        echo "Ejecutando tests..."
        echo "Esto puede tomar unos segundos..."
        npm test
        echo "Tests completados"
    
    # 6. Resumen
    - name: Resumen de tests
      if: always()  # Se ejecuta siempre, incluso si los tests fallan
      run: |
        echo "Resumen de la ejecución:"
        echo "Los tests se ejecutaron automáticamente"
        echo "Esto pasa en cada push y pull request"
        echo "Si un test falla, el workflow falla"
        echo "Esto previene que código roto llegue a producción"
